<?xml version='1.0'?>
<!--
 * Copyright 2001-2009 The Apache Software Foundation.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */ -->

<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "jUDDI_User_Guide.ent">
%BOOK_ENTITIES;
]>

<!-- chapter: Using the UDDI-Client -->
<chapter id="chap-root_seed_data">
    <title>Root Seed Data</title>

    <!-- section: Introduction -->
    <section id="sect-root_seed_data_intro">
        <title>Introduction</title>
        <para>
        As of UDDI v3, each registry need to have a <literal>“root”</literal> publisher.
        The root publisher is the owner of the UDDI services (inquiry, publication, etc).
        There can only be one root publisher per node. JUDDI ships some default seed data
        for the root account. The default data can be found in the
        <filename>juddi-core-3.x.jar</filename>, under
        <filename>juddi_install_data/</filename>. By default jUDDI installs two
        Publishers: <literal>“root”</literal> and <literal>“uddi”</literal>. Root owns the
        root partition, and uddi owns all the other seed data such as pre-defined tModels.
        </para>

    </section>
    
    <!-- section: Seed Data Files -->
    <section id="sect-seed_data_files">
        <title>Seed Data Files</title>
        
        <para>
        For each publisher there are four seed data files that will be read the first time
        you start jUDDI:
        </para>
    
        <screen><xi:include href="extras/Root_seed_data_1.screen" parse="text" xmlns:xi="http://www.w3.org/2001/XInclude" /></screen>
        
        <para>
        For example the content of the <filename>root_Publisher.xml</filename> looks like
        </para>
    
        <programlisting language="XML"><xi:include href="extras/Root_seed_data_1.xmlt" parse="text" xmlns:xi="http://www.w3.org/2001/XInclude" /></programlisting>
        
        <para>
        Each publisher should have its own key generator schema so that custom generated
        keys cannot end up being identical to keys generated by other publishers. It is
        therefor that the each publisher need to define their own KenGenerator tModel. The
        tModel Key Generator is defined in the file <filename>root_tModelKeyGen.xml</filename> 
        and the content of this file is
        </para>
    
        <programlisting language="XML"><xi:include href="extras/Root_seed_data_2.xmlt" parse="text" xmlns:xi="http://www.w3.org/2001/XInclude" /></programlisting>


        <para>
        This means that the legal format of keys used by the root publisher need to be in
        the form <literal>uddi:juddi.apache.org:&lt;text-of-chioce&gt;</literal> The use 
        of other types of format will lead to an 'illegal key' error. The root publisher
        can only own one KeyGenerator while any other publisher can own more then one
        KeyGenerator. KeyGenerators should not be shared unless there is a good reason to
        do so. If you want to see your publisher with more then just the one KeyGenerator
        tModel, you can use the<filename> &lt;publisher&gt;_tModels.xml</filename> file.
        </para>

        <para>
        Finally, in the <filename>&lt;publisher&gt;_BusinessEntity.xml</filename> file can
        be used to setup Business and Service data. In the <filename>root_BusinessEntity.xml</filename> we
        specified the ASF Business, and the UDDI services; Inquiry, Publish, etc.:
        </para>
    
        <programlisting language="XML"><xi:include href="extras/Root_seed_data_3.xmlt" parse="text" xmlns:xi="http://www.w3.org/2001/XInclude" /></programlisting>

        <para>
        Note that the seeding process only kicks off if no publishers exist in the
        database. So this will only work with a clean database, unless you set
        <literal>juddi.seed.always</literal> to true. Then it will re-apply all files with
        the exception of the root data files. Note that this can lead to losing data that
        was added to entities that are re-seeded, since data is not merged.
        </para>
    
    </section>
    
    <!-- section: Tokens in the Seed Data -->
    <section id="sect-tokens_in_the_seed_data">
        <title>Token in the Seed Data</title>
        <para>
        You may have noticed the tokens in the <filename>root_BusinessEntity.xml</filename> 
        file (<literal>${juddi.server.baseurl}</literal>. The value of this tokens can set in
        the <filename>juddiv3.properties</filename> file. The value substitution takes place
        at runtime, so that different nodes can do the substitution  with their own value if needed.
        </para>
    </section>

    <!-- section: Customer Seed Data -->
    <section id="sect-custom_seed_data">
        <title>Customer Seed Data</title>
        <para>
        In your deployment you probably do not want to use the Seed Data shipped with the
        default jUDDI install. The easiest way to overwrite this data is to add it to a
        directory call <filename>juddi_custom_install_data</filename> in the
        <filename>juddiv3.war/WEB-INF/classes/</filename> directory. That way you don't
        have to modify the <filename>juddi-core-3.x.jar</filename>. Additionally if your
        root publisher is not called “root” you will need to set the
        <property>juddi.root.publisher</property> property in the
        <filename>juddiv3.properties</filename> file to something other then
        </para>
    
        <programlisting><xi:include href="extras/Root_seed_data_1.properties" parse="text" xmlns:xi="http://www.w3.org/2001/XInclude" /></programlisting>

        <para>
        The <filename>juddiv3.war</filename> ships with two example data directory. One
        for the Sales Affiliate, and one for the Marketing Affiliate. To use the Sales
        Seed Data, in the <filename>juddiv3.war/WEB-INF/classes/</filename>, rename the
        directory
        </para>
    
       <screen><xi:include href="extras/Root_seed_data_2.screen" parse="text" xmlns:xi="http://www.w3.org/2001/XInclude" /></screen>
        
        <para>
        before you start jUDDI the first time. It will then use this data to populate the
        database. If you want to rerun you can trash the database it created and restart
        tomcat. Don't forget to set the tokens in the <filename>juddiv3.properties</filename> file.
        </para>
    </section>
    

</chapter>
